FROM ##demomachine.jar##

MAINTAINER Adobe Systems Incorporated

ARG aem_port
ARG read_only

ENV port ${aem_port}

ADD author/crx-quickstart/launcher /launcher

RUN yum install -y socat && yum clean all

RUN /aem/create_segmentstore.sh

RUN mkdir -p /docker_entrypoint.d && \
    echo "socat TCP4-LISTEN:##AdobeAEM.publishport##,fork TCP4:publish:##AdobeAEM.publishport## &" > /docker_entrypoint.d/10-create-tunnel.sh && \
    chmod 755 /docker_entrypoint.d/10-create-tunnel.sh
